name: Docker Build

on:
  push:
    branches:
      - main

jobs:
  docker:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php-version:
          - "7.4"
          - "8.0"
          - "8.1"
          - "8.2"
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Check image
        id: image_exists
        uses: cloudposse/github-action-docker-image-exists@main
        with:
          repository: php
          login: "${{ secrets.DOCKERHUB_USERNAME }}"
          password: "${{ secrets.DOCKERHUB_PASSWORD }}"
          tag: ${{ matrix.php-version }}-fpm-alpine
      - name: An example step (get the label matching id 'testlabel')
        run: |
          echo '${{ steps.image_exists.outputs.tag }}'
      # - name: Docker meta
      #   id: meta
      #   uses: docker/metadata-action@v4
      #   with:
      #     images: |
      #       xmpls/php
      #       ghcr.io/build-xmpls/php
      #     tags: |
      #       type=schedule
      #       type=semver,pattern={{version}},value=${{ steps.latest_php_version.outputs.value }}
      #       type=semver,pattern={{major}}.{{minor}},value=${{ steps.latest_php_version.outputs.value }}
      #       type=semver,pattern={{major}},value=${{ steps.latest_php_version.outputs.value }}
      # - name: Set up QEMU
      #   uses: docker/setup-qemu-action@v1
      # - name: Set up Docker Buildx
      #   uses: docker/setup-buildx-action@v1
      # - name: Login to DockerHub
      #   uses: docker/login-action@v2
      #   with:
      #     username: ${{ secrets.DOCKERHUB_USERNAME }}
      #     password: ${{ secrets.DOCKERHUB_TOKEN }}
      # - name: Login to GHCR
      #   uses: docker/login-action@v2
      #   with:
      #     registry: ghcr.io
      #     username: ${{ github.repository_owner }}
      #     password: ${{ secrets.GITHUB_TOKEN }}
      # - name: Build and push
      #   uses: docker/build-push-action@v4
      #   with:
      #     context: .
      #     platforms: linux/amd64,linux/386,linux/arm64,linux/arm/v7,linux/arm/v6
      #     push: true
      #     build-args: |
      #       PHP_BASE_IMAGE=php:${{ steps.meta.outputs.version }}-fpm-alpine
      #     tags: ${{ steps.meta.outputs.tags }}
      #     labels: ${{ steps.meta.outputs.labels }}
      # - name: Update repo description
      #   uses: peter-evans/dockerhub-description@v3
      #   with:
      #     username: ${{ secrets.DOCKERHUB_USERNAME }}
      #     password: ${{ secrets.DOCKERHUB_PASSWORD }}
      #     repository: xmpls/php-fpm
      #     short-description: ${{ github.event.repository.description }}

